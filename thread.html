<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>进程守护</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Main -->
		<div id="main">
			<div class="inner">

				<!-- Header -->
				<header id="header">
					<a href="index.html" class="logo">autMan</a>
					<ul class="icons">
						<li><a href="https://github.com/hdbjlizhe/fanli" class="icon brands fa-github"><span
									class="label">Github</span></a></li>
						<li><a href="tencent://message/?uin=282617666&Site=&Menu=yes" target="_blank" title="点击添加群主"
								class="icon brands fa-qq"><span class="label">QQ</span></a></li>
						<li><a href="#" class="icon brands fa-telegram"><span class="label">Telegram</span></a></li>
					</ul>
				</header>

				<!-- Content -->
				<section>
					<header class="main">
						<h1>进程守护</h1>
					</header>

					<!-- Content -->
					<h2 id="content">监听转发</h2>
					<p>转发时一直带图片：set fanli transfer_pic true</p>

					<h3>守护autMan进程</h3>
					<p>指令：守护奥特曼</p>
					<P>原理如下：</P>
					<p>1.vim /usr/lib/systemd/system/autMan.service #新建机器人系统服务文件
						按键盘字母 i 进入编辑模式，复制下面esc 退出编辑模式，再输入命令 :wq 保存并退出。</p>
					<pre><code>[Unit]
Description=bot
After=network.target mysql.service mariadb.service mysqld.service
[Service]
Type=forking
ExecStart=/root/autMan/autMan -d
PIDFile=/var/run/autMan.pid
Restart=always
User=root
Group=root
		
[Install]
WantedBy=multi-user.target
Alias=autMan.service</code></pre>
					<h3>守护控制</h3>
					<p>分别输入下面的命令激活</p>
					<pre><code>systemctl daemon-reload #重新加载所有被修改过的服务配置，否则配置不会生效
systemctl enable autMan.service #设置为开机自启
systemctl start autMan.service #启动服务
# 其他常用的管理命令
systemctl restart autMan.service #重启服务
systemctl stop autMan.service #停止服务
systemctl status autMan.service #查看运行状态</code></pre>


					<h3>pm2守护onebot</h3>
					<pre><code>pm2 start "node main 机器人QQ号" #pm2方式启动onebot
pm2 list #查看进程
pm2 restart "node main 机器人QQ号" #重启
pm2 delete "node main 机器人QQ号" #结束进程</code></pre>

					<p>这样，你的机器人和onebot基本上不会掉线了。
						如果你使用了systemd方式守护进程，再手动启动时，会提示已杀死进程。
						你需要先停止系统进程，再重新进入机器人终端交互。</p>
					<pre><code>stop autMan.service #停止机器人系统服务
cd autMan#cd到机器人目录
./autMan -t #终端交互启动机器人</code></pre>
					<p>qq经常容易风控，有时候qq不回复消息了，但是检查进程和对接都是好的，那极有可能就是机器人被风控了。</p>




					<div class="row">

					</div>


				</section>

			</div>
		</div>

		<!-- Sidebar -->
		<div id="sidebar">
			<div class="inner">
				<include src="sidebar.html"></include>
			</div>
		</div>

	</div>

	<!-- Scripts -->
	<script src="assets/js/include.js"></script>
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

</body>

</html>